version: 2
jobs:
    build:
        docker:
            -   image: ubuntu:latest
        steps:
            - checkout
            -   restore_cache:
                    key: cache
            -   run:
                    command: |
                             apt update && apt install --yes curl gcc
                             curl https://sh.rustup.rs -sSf | sh -s -- -y --default-toolchain nightly
                             source $HOME/.cargo/env
            -   run:
                    name:    Check Code
                    command: |
                             cargo c
            -   run:
                    name:    Check Format
                    command: |
                             rustup component add rustfmt
                             cargo fmt -- --check
            -   run:
                    name:    Check Clippy
                    command: |
                             rustup component add clippy
                             cargo clippy --all
            -   run:
                    name:    Test
                    command: |
                             cargo test --verbose
            -   save_cache:
                    key: cache
                    paths:
                        - "~/.cargo"
                        - "./target"